# add

Track data files or directories with DVC, by creating a corresponding
[DVC-file](/doc/user-guide/dvc-file-format).

## Synopsis

```usage
usage: dvc add [-h] [-q | -v] [-R] [--no-commit] [-f <filename>]
               targets [targets ...]

positional arguments:
  targets               Input files/directories to add.
```

## Description

The `dvc add` command is analogous to `git add`, in that it makes DVC aware of
the target data, as a first step to version it. It creates a
[DVC-file](/doc/user-guide/dvc-file-format) to track the added data.

The `targets` are files or directories to add with this command, that are turned
into <abbr>data artifacts</abbr> of the <abbr>project</abbr>. By default, these
are committed to the <abbr>cache</abbr> (use the `--no-commit` option to avoid
this, and `dvc commit` to finish the process when needed).

Note that [external data](/doc/user-guide/managing-external-data) (targets
outside the <abbr>workspace</abbr>) is supported.

Under the hood, a few actions are taken for each file (or directory) in
`targets`:

1. Calculate the file hash.
2. Move the file contents to the cache directory (by default in `.dvc/cache`),
   using the file hash to form the cached file names. (See
   [Structure of cache directory](/doc/user-guide/dvc-files-and-directories#structure-of-cache-directory)
   for more details.)
3. Attempt to replace the file with a link to the cached data (more details
   further down).
4. Create a corresponding DVC-file to store the file (as an
   <abbr>output</abbr>), using its path and hash to identify the cached data.
   Unless the `-f` option is used, the DVC-file name generated by default is
   `<file>.dvc`, where `<file>` is the file name of the first target.
5. Unless `dvc init --no-scm` was used when initializing the project, add the
   `targets` to `.gitignore` in order to prevent them from being committed to
   the Git repository.
6. Instructions are printed showing `git` commands for adding the files, if
   appropriate.

Summarizing, the result is that the target data is replaced small DVC-files can
be tracked with Git. See [DVC-File Format](/doc/user-guide/dvc-file-format) for
more details.

> Note that DVC-files created by this command are considered _orphan stage
> files_ because they have no _dependencies_, only outputs. These are always
> treated as _changed_ by `dvc repro`, which always executes them. See `dvc run`
> to learn more about stage files.

To avoid adding files inside a directory accidentally, you can add the
corresponding [patterns](/doc/user-guide/dvcignore) in a `.dvcignore` file.

By default DVC tries to use reflinks (see
[File link types](/doc/user-guide/large-dataset-optimization#file-link-types-for-the-dvc-cache)
to avoid copying any file contents and to optimize DVC-file operations for large
files. DVC also supports other link types for use on file systems without
`reflink` support, but they have to be specified manually. Refer to the
`cache.type` config option in `dvc config cache` for more information.

A `dvc add` target can be an individual file or a directory. There are two ways
to work with directory hierarchies with `dvc add`:

1. With `dvc add --recursive`, the hierarchy is traversed and every file is
   added individually as described above. This means every file has its own
   DVC-file, and a corresponding cached file is created (unless the
   `--no-commit` option is used).
2. When not using `--recursive` a DVC-file is created for the top of the
   directory (with default name `dirname.dvc`). Every file in the hierarchy is
   added to the cache (unless the `--no-commit` option is used), but DVC does
   not produce individual DVC-files for each file in the directory tree.
   Instead, the single DVC-file references a special JSON file in the cache
   (with `.dir` extension), that in turn points to the files added from the
   hierarchy.

`dvc add` is typically used to version control raw data or initial datasets from
which data processing [pipelines](/doc/command-reference/pipeline) are built,
but it can be used to track any large file or directory. We recommend using
`dvc run` to version control intermediate and final results (like ML models).
This way you bring data provenance and make your project
[reproducible](/doc/command-reference/repro).

## Options

- `-R`, `--recursive` - determines the files to add by searching each target
  directory and its subdirectories for data files. If there are no directories
  among the `targets`, this option is ignored. For each file found, a new
  DVC-file is created using the process described in this command's description.

- `--no-commit` - do not save outputs to cache. A DVC-file is created and an
  entry is added to `.dvc/state`, while nothing is added to the cache.
  (`dvc status` will report that the file is `not in cache`.) Use `dvc commit`
  when ready to commit outputs with DVC. This is analogous to using `git add`
  before `git commit`.

- `-f <filename>`, `--file <filename>` - specify name of the DVC-file it
  generates. This option works only if there is a single target. By default the
  name of the generated DVC-file is `<target>.dvc`, where `<target>` is the file
  name of the given target. This option allows to set the name and the path of
  the generated DVC-file.

- `-h`, `--help` - prints the usage/help message, and exit.

- `-q`, `--quiet` - do not write anything to standard output. Exit with 0 if no
  problems arise, otherwise 1.

- `-v`, `--verbose` - displays detailed tracing information.

## Example: Single file

Track a file with DVC:

```dvc
$ dvc add data.xml

Saving information to 'data.xml.dvc'.

To track the changes with git run:

	git add .gitignore data.xml.dvc
```

As shown above, a [DVC-file](/doc/user-guide/dvc-file-format) has been created
for `data.xml`. Let's explore the result:

```dvc
$ tree
.
├── data.xml
└── data.xml.dvc
```

Let's check the `data.xml.dvc` file inside:

```yaml
md5: aae37d74224b05178153acd94e15956b
outs:
  - cache: true
    md5: d8acabbfd4ee51c95da5d7628c7ef74b
    metric: false
    path: data.xml
meta: # Special field to contain arbitary user data
  name: John
  email: john@xyz.com
```

This is a standard DVC-file with only one output (in the `outs` field). The hash
value should correspond to a file path in the <abbr>cache</abbr>.

> Note that the `meta` values above were entered manually for this example. Meta
> values and `#` comments are not preserved when a DVC-file is overwritten with
> the `dvc add`, `dvc run`, `dvc import`, or `dvc import-url` commands.

```dvc
$ file .dvc/cache/d8/acabbfd4ee51c95da5d7628c7ef74b

.dvc/cache/d8/acabbfd4ee51c95da5d7628c7ef74b: ASCII text
```

Note that tracking compressed files (e.g. ZIP or TAR archives) is not
recommended, as `dvc add` supports tracking directories. (Details below.)

## Example: Directory

Let's suppose your goal is to build an algorithm to identify cats and dogs in
pictures. You may then have hundreds or thousands of pictures of these animals
in a directory, and this is your training dataset:

```dvc
$ tree pics --filelimit 3
pics
├── train
│   ├── cats [many image files]
│   └── dogs [many image files]
└── validation
    ├── cats [more image files]
    └── dogs [more image files]
```

Tracking a directory with DVC as simple as with a single file:

```dvc
$ dvc add pics
Computing md5 for a large number of files. This is only done once.
...
Linking directory 'pics'.

Saving information to 'pics.dvc'.
...
```

There are no [DVC-files](/doc/user-guide/dvc-file-format) generated within this
directory structure, but the images are all added to the <abbr>cache</abbr>. DVC
prints a message mentioning that MD5 hash values are computed for each file. A
single `pics.dvc` DVC-file is generated for the top-level directory, and it
contains:

```yaml
md5: df06d8d51e6483ed5a74d3979f8fe42e
outs:
  - cache: true
    md5: b8f4d5a78e55e88906d5f4aeaf43802e.dir
    metric: false
    path: pics
wdir: .
```

> Refer to
> [Structure of cache directory](/doc/user-guide/dvc-files-and-directories#structure-of-cache-directory)
> for more info.

This allows us to treat the entire directory structure as a single <abbr>data
artifact</abbr>. This lets you pass the whole directory tree as a
<abbr>dependency</abbr> to a `dvc run` stage definition:

```dvc
$ dvc run -f train.dvc \
          -d train.py -d pics \
          -M metrics.json -o model.h5 \
          python train.py
```

> To follow the full example, see the [Versioning](/doc/tutorials/versioning)
> tutorial.

If instead we use the `--recursive` (`-R`) option, the output looks like this:

```dvc
$ dvc add -R pics
Saving information to 'pics/cat1.jpg.dvc'.
Saving information to 'pics/cat3.jpg.dvc'.
Saving information to 'pics/cat2.jpg.dvc'.
Saving information to 'pics/cat4.jpg.dvc'.
...
```

In this case, a DVC-file is generated for each file in the `pics/` directory
tree. No top-level DVC-file is generated, which is typically less convenient.
For example, we cannot use the directory structure as one unit with `dvc run` or
other commands.

## Example: Dvcignore

Let's take an example to illustrate how `.dvcignore` interacts with `dvc add`.

```dvc
$ mkdir dir
$ echo file_one > dir/file1
$ echo file_two > dir/file2
```

Now add `file1` to `.dvcignore` and track the entire `dir` directory with
`dvc add`.

```dvc
$ echo dir/file1 > .dvcignore
$ dvc add dir
```

Let's now modify `file1` (which is listed in `.dvcignore`) and run `dvc status`:

```dvc
$ echo file_one_changed > dir/file1
$ dvc status
Data and pipelines are up to date.
```

`dvc status` ignores changes to files listed in `.dvcignore`.

Let's have a look at cache directory:

```dvc
$ tree .dvc/cache
.dvc/cache
├── 0a
│   └── ec3a687bd65c3e6a13e3cf20f3a6b2.dir
└── 52
    └── 4bcc8502a70ac49bf441db350eafc2
```

Only the hash values of directory (`dir/`) and `file2` have been cached.

See [Dvcignore](/doc/user-guide/dvcignore) for more details.
